# SWOffinder Off-Target Annotation Script

This repository provides a **post-processing script** for annotating off-target hits generated by **[SWOffinder](https://github.com/OrensteinLab/SWOffinder)**.  
**Note: I am *not* the developer of SWOffinder.**  
This tool only adds biological context to its output.

---

## What this script does

Given:
- **SWOffinder output CSV files:** `<prefix>_offtargets_*.csv`
- **Genome annotation (GFF3)**

The script:
- Annotates each off-target site with genomic context:  
  `CDS / Exon / Intron / 5UTR / 3UTR / Promoter / Intergenic`
- Counts mismatches in the seed region (10 nt upstream of PAM)
- Reports total edits (`#Edit`)
- Assigns a simple risk category: `High / Medium / Low`
- Outputs annotated CSV files

This helps evaluate off-target hits based on biological features.

---

## Input Requirements

### 1. SWOffinder CSV files
These should be generated using SWOffinder with an output prefix, e.g.:

```bash
MyGenome_offtargets_sgRNA1.csv
MyGenome_offtargets_sgRNA2.csv
```

### 2. GFF3 Gene Model
A proper structural annotation with:
- gene
- exon
- CDS
- five_prime_UTR
- three_prime_UTR

Example:

```bash
Dnig_genes_v1.3.UTR.agat.gff3
```

---

## How risk category is assigned

| Condition | Risk |
|---------|------|
| `#Edit ≤ 2` **AND** Seed mismatches ≤ 1 | **High** |
| `#Edit ≤ 3` **AND** Seed mismatches ≤ 2 | **Medium** |
| Otherwise | **Low** |

This prioritizes:
- Higher similarity to sgRNA
- Mismatches outside the seed region

> This is a heuristic — adjust thresholds as needed.

---

## Installation

Requires Python ≥ 3.8

```bash
pip install pandas
```

---

## Usage

Typical command:

```bash
python annotate_swoffinder.py
--base-dir /path/to/swoffinder/results
--gff /path/to/genome.gff3
--prefix MyGenome
```

### Optional parameters

| Parameter | Default | Description |
|----------|--------|-------------|
| `--base-dir` | `.` | Directory containing CSV files |
| `--gff` | — | Path to GFF3 (required) |
| `--prefix` | — | SWOffinder output prefix (required) |
| `--promoter-upstream` | `2000` | Promoter window (bp) |
| `--seed-len` | `10` | Seed region length before PAM |

---

## Example

SWOffinder output:

```bash
MyGenome_offtargets_sgRNA01.csv
MyGenome_offtargets_sgRNA02.csv
```

Run:

```bash
python annotate_swoffinder.py
--base-dir ./results
--gff ./annotation/MyGenome.gff3
--prefix MyGenome
```

Annotated files will be created:

```bash
MyGenome_offtargets_sgRNA01_annotated.csv
MyGenome_offtargets_sgRNA02_annotated.csv
```

---

## Output columns (added)

| Column | Meaning |
|------|--------|
| `GenomicStart / GenomicEnd` | Off-target genomic interval |
| `GenomicLength` | Length excluding alignment gaps |
| `RegionType` | Genomic annotation |
| `GeneIDs` | Hit gene(s) |
| `SeedMismatches` | Mismatches in PAM-proximal seed |
| `RiskCategory` | High / Medium / Low |

## Disclaimer

> This annotation tool is independent.  
> I am **not affiliated with SWOffinder developers** and do not maintain SWOffinder itself.

